<!-- ================= NEONEX PRO: CORE ENGINE ================= -->
<!-- Dependências seguras via CDN -->
<script src="https://cdn.jsdelivr.net"></script>
<script src="https://cdnjs.cloudflare.com"></script>
<script src="https://cdn.jsdelivr.net"></script>

<style>
  :root {
    --neon-cyan: #00e5ff;
    --neon-purple: #7c4dff;
    --glass-bg: rgba(11, 11, 15, 0.85);
  }

  .neonex-main-card {
    background: var(--glass-bg);
    backdrop-filter: blur(20px);
    -webkit-backdrop-filter: blur(20px);
    border: 1px solid rgba(0, 229, 255, 0.2);
    border-radius: 24px;
    padding: 24px;
    margin: 16px;
    box-shadow: 0 0 30px rgba(0, 229, 255, 0.05);
  }

  .balance-display {
    text-align: center;
    padding: 20px 0;
    background: linear-gradient(180deg, rgba(0, 229, 255, 0.1) 0%, transparent 100%);
    border-radius: 16px;
    margin-bottom: 20px;
  }

  .crypto-value {
    font-size: 32px;
    font-weight: 800;
    color: var(--neon-cyan);
    text-shadow: 0 0 15px rgba(0, 229, 255, 0.5);
  }

  .neonex-input-group {
    position: relative;
    margin-bottom: 15px;
  }

  .neonex-input-group input {
    width: 100%;
    background: rgba(255,255,255,0.05);
    border: 1px solid rgba(0, 229, 255, 0.2);
    padding: 14px;
    border-radius: 12px;
    color: #fff;
    transition: 0.3s;
  }

  .neonex-input-group input:focus {
    border-color: var(--neon-cyan);
    box-shadow: 0 0 15px rgba(0, 229, 255, 0.2);
    outline: none;
  }

  .action-btn {
    width: 100%;
    padding: 16px;
    border-radius: 14px;
    border: none;
    background: linear-gradient(90deg, var(--neon-cyan), var(--neon-purple));
    color: #000;
    font-weight: 900;
    text-transform: uppercase;
    letter-spacing: 1px;
    cursor: pointer;
    transition: 0.3s;
  }

  .action-btn:active { transform: scale(0.98); }

  #qrcode {
    background: white;
    padding: 12px;
    border-radius: 12px;
    display: inline-block;
    margin-top: 15px;
  }
</style>

<section class="neonex-main-card">
  <!-- Status da Rede -->
  <div style="display:flex; justify-content: space-between; font-size: 10px; color: var(--neon-cyan); margin-bottom: 15px;">
    <span>● POLYGON MAINNET</span>
    <span id="network-status">LATÊNCIA: --ms</span>
  </div>

  <!-- Display de Saldo -->
  <div class="balance-display">
    <p style="font-size: 12px; color: #aaa; margin:0">SALDO DISPONÍVEL</p>
    <div class="crypto-value"><span id="display-balance">0.00</span> <small style="font-size: 14px">POL</small></div>
    <p id="display-address" style="font-size: 10px; color: #666; margin-top: 8px; cursor: pointer;">Clique para copiar endereço</p>
  </div>

  <!-- Terminal de Operações -->
  <div id="setup-area">
    <button class="action-btn" onclick="initWallet()">Acessar Terminal NEONEX</button>
  </div>

  <div id="terminal-area" class="hidden">
    <div class="neonex-input-group">
      <input type="text" id="target-addr" placeholder="Endereço de Destino (0x...)">
    </div>
    <div class="neonex-input-group">
      <input type="number" id="target-amount" placeholder="Valor (POL)">
    </div>
    
    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
      <button class="action-btn" style="background: #1a1a20; color: #fff; border: 1px solid var(--neon-cyan);" onclick="generatePaymentQR()">Gerar QR</button>
      <button class="action-btn" onclick="executeTransfer()">Pagar Agora</button>
    </div>

    <div id="qr-display" class="hidden" style="text-align: center;">
      <div id="qrcode-container"></div>
      <p style="font-size: 10px; margin-top: 8px;">Padrão EIP-681 Interoperável</p>
    </div>
  </div>
</section>

<script>
  // Configurações de Infraestrutura 2026
  const CONFIG = {
    rpc: "https://polygon-rpc.com", // Em escala, troque por Alchemy/Quicknode
    chain: 137,
    symbol: "POL" // Polygon mudou MATIC para POL
  };

  const provider = new ethers.JsonRpcProvider(CONFIG.rpc);
  let userWallet = null;

  // 1. Inicialização de Carteira com Criptografia Simples
  async function initWallet() {
    let privKey = localStorage.getItem("_nx_pk");
    
    if (!privKey) {
      const newWallet = ethers.Wallet.createRandom();
      // Em produção, solicite um PIN ao usuário para encriptar aqui
      privKey = newWallet.privateKey;
      localStorage.setItem("_nx_pk", privKey);
    }

    userWallet = new ethers.Wallet(privKey, provider);
    document.getElementById("setup-area").classList.add("hidden");
    document.getElementById("terminal-area").classList.remove("hidden");
    refreshData();
  }

  // 2. Atualização de Dados (Stress Test Ready)
  async function refreshData() {
    if (!userWallet) return;
    try {
      const start = Date.now();
      const balance = await provider.getBalance(userWallet.address);
      const latency = Date.now() - start;
      
      document.getElementById("display-balance").textContent = parseFloat(ethers.formatEther(balance)).toFixed(4);
      document.getElementById("display-address").textContent = userWallet.address.shorten();
      document.getElementById("network-status").textContent = `LATÊNCIA: ${latency}ms`;
    } catch (e) {
      console.error("Erro RPC:", e);
    }
  }

  // 3. Gerador de QR Code Inteligente (Padrão Bancário Cripto)
  function generatePaymentQR() {
    const amount = document.getElementById("target-amount").value;
    const container = document.getElementById("qrcode-container");
    container.innerHTML = "";
    
    // Padrão EIP-681: ethereum:0x.../transfer?value=...
    const paymentUri = `ethereum:${userWallet.address}@${CONFIG.chain}/transfer?value=${amount}`;
    
    new QRCode(container, {
      text: paymentUri,
      width: 180,
      height: 180,
      colorDark: "#00e5ff",
      colorLight: "#0b0b0f"
    });
    document.getElementById("qr-display").classList.remove("hidden");
  }

  // 4. Execução de Transferência (Fast Path)
  async function executeTransfer() {
    const to = document.getElementById("target-addr").value;
    const val = document.getElementById("target-amount").value;

    if(!ethers.isAddress(to)) return alert("Endereço Inválido");

    try {
      const tx = await userWallet.sendTransaction({
        to: to,
        value: ethers.parseEther(val)
      });
      alert(`Enviado! Hash: ${tx.hash.substring(0,10)}...`);
    } catch (e) {
      alert("Erro na rede. Verifique o saldo de Gás.");
    }
  }

  // Helper para encurtar endereço
  String.prototype.shorten = function() {
    return this.substring(0, 6) + "..." + this.substring(this.length - 4);
  };

  // Auto-refresh (Pooling Eficiente)
  setInterval(refreshData, 15000);
    </script>
    
